<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fake WA Generator - 1:1 Realistis</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="script.js" defer></script>
    <link rel="stylesheet" href="styles.css">

    !-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#128C7E">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Pod Express">
    
    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="./icon-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="./icon-512x512.png">
    <link rel="apple-touch-icon" href="./icon-192x192.png">

    <!-- DARI INI: -->
<!-- Cek di <head>, pastikan path benar: -->
<link rel="manifest" href="/MAGER-NGEDIT/manifest.json">

<!-- KE INI (lebih spesifik): -->
<link rel="manifest" href="/manifest.json" crossorigin="use-credentials">
    
<style>
/* RESET */

    </style>
</head>
<body>
    <!-- MOBILE TOGGLE BUTTON -->
    <button class="mobile-toggle" onclick="toggleControlPanel()">
        <span class="material-symbols-outlined">tune</span>
    </button>
    
    <div class="main-container">
        <!-- PANEL KONTROL -->
        <div class="control-panel">
            <!-- HEADER -->
            <div class="panel-header">
                <h2>‚öôÔ∏è Fake WA Generator</h2>
                <p>Generate WhatsApp chat mockup</p>
            </div>
            
            <!-- TABS -->
            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('basic')">
                    <span class="material-symbols-outlined">settings</span>
                    Settings
                </button>
                <button class="tab-btn" onclick="switchTab('bulk')">
                    <span class="material-symbols-outlined">description</span>
                    Bulk Excel
                </button>
            </div>
            
            <!-- TAB CONTENT: BASIC (GABUNG BASIC + CHAT) -->
            <div id="tab-basic" class="tab-content active">
                <!-- FOTO PROFIL -->
                <div class="section-card" id="profilePictureSection">
                    <h3>
                        <span class="material-symbols-outlined">account_circle</span>
                        Foto Profil
                    </h3>
                    <p style="font-size: 12px; color: #666; margin-bottom: 10px;">
                        üí° Tip: Klik area foto, lalu <strong>Ctrl+V</strong> untuk paste gambar dari clipboard
                    </p>
                    <input type="file" id="profilePicture" accept="image/*" onchange="handleProfilePicture()" class="file-input">
                    <label for="profilePicture" class="file-label">
                        <span class="material-symbols-outlined">add_photo_alternate</span>
                        Upload Foto
                    </label>
                    <div class="avatar-preview" id="avatarPreview" tabindex="0" style="cursor: pointer; outline: none;">
                        <img id="previewImg" src="https://i.ibb.co.com/HT77KvxN/image.png">
                        <button onclick="resetProfilePicture()" class="btn-icon-only btn-danger">
                            <span class="material-symbols-outlined">delete</span>
                        </button>
                    </div>
                </div>
                
                <!-- DATA KONTAK -->
                <div class="section-card">
                    <h3>
                        <span class="material-symbols-outlined">phone</span>
                        Data Kontak
                    </h3>
                    <label>Nomor HP (Wajib)</label>
                    <input type="text" id="contactName" value="" oninput="updateContent()" onblur="formatPhoneNumber(this)" placeholder="+62 812-xxx-xxxx">
                    
                    <label>Nama Kontak (Opsional)</label>
                    <input type="text" id="contactStatus" value="" oninput="updateContent()" placeholder="~ Nama Kontak">
                    
                    <label>Bio/Info (Opsional)</label>
                    <input type="text" id="contactBio" value="" oninput="updateContent()" placeholder="Tersedia">
                    
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="contactSaved" onchange="updateContent()">
                            <span>Kontak Disimpan</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="contactPrivacy" onchange="updateContent()" checked>
                            <span>Mode Privasi</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="showLastSeen" onchange="updateContent()">
                            <span>Tampilkan "Terakhir dilihat"</span>
                        </label>
                    </div>
                </div>
                
                <!-- NOMOR RESI -->
                <div class="section-card">
                    <h3>
                        <span class="material-symbols-outlined">local_shipping</span>
                        Nomor Resi
                    </h3>
                    <p class="hint">Auto-detect dari pesan atau input manual</p>
                    <div class="input-with-btn">
                        <input type="text" id="resiNumber" value="" placeholder="JX6777164069" oninput="updateContent()">
                        <button onclick="toggleResiEdit()" id="btnEditResi" class="btn-secondary">
                            <span class="material-symbols-outlined">edit</span>
                        </button>
                    </div>
                    <p class="hint-small">Support multiple: JX001,JX002</p>
                </div>
                
                <!-- TAMBAH PESAN -->
                <div class="section-card">
                    <h3>
                        <span class="material-symbols-outlined">chat_bubble</span>
                        Tambah Pesan
                    </h3>
                    
                    <label class="checkbox-label checkbox-highlight">
                        <input type="checkbox" id="autoReplyCancel" checked>
                        <span>‚ö†Ô∏è Auto-reply BATAL/CANCEL/RETUR</span>
                    </label>
                    
                    <label>Teks Pesan</label>
                    <textarea id="newMessageText" rows="4" placeholder="Ketik pesan..."></textarea>
                    
                    <div class="input-row">
                        <div class="input-col">
                            <label>Pengirim</label>
                            <select id="messageSender">
                                <option value="outgoing">Outgoing (Hijau)</option>
                                <option value="incoming">Incoming (Putih)</option>
                            </select>
                        </div>
                        <div class="input-col">
                            <label>Status</label>
                            <select id="messageStatus">
                                <option value="sent">Terkirim</option>
                                <option value="delivered">Tersampaikan</option>
                                <option value="read" selected>Dibaca</option>
                            </select>
                        </div>
                    </div>
                    
                    <button onclick="addMessage()" class="btn-primary">
                        <span class="material-symbols-outlined">add</span>
                        Tambah Pesan
                    </button>
                </div>
                
                <!-- RIWAYAT CHAT -->
                <div class="section-card">
                    <h3>
                        <span class="material-symbols-outlined">history</span>
                        Riwayat Chat
                    </h3>
                    <div id="chatHistoryEditor" class="chat-history"></div>
                    <button onclick="clearChat()" class="btn-danger">
                        <span class="material-symbols-outlined">delete_sweep</span>
                        Bersihkan Semua
                    </button>
                </div>
                
                <!-- EXPORT PNG -->
                <button onclick="exportCollage()" class="btn-primary">
                    <span class="material-symbols-outlined">download</span>
                    Export PNG
                </button>
            </div>
            
            <!-- TAB CONTENT: CHAT - DIHAPUS, SUDAH DIGABUNG KE BASIC -->
            
            <!-- TAB CONTENT: BULK -->
            <div id="tab-bulk" class="tab-content">
                <div class="section-card">
                    <h3>
                        <span class="material-symbols-outlined">upload_file</span>
                        Upload Excel
                    </h3>
                    <p class="hint">üìã Format kolom: <strong>Nomor, Resi, Foto, Nama, Bio, Balasan, Pesan</strong></p>
                    <p class="hint" style="font-size: 11px; margin-top: -8px;">
                        üí° <strong>Foto:</strong> URL gambar (https://...) atau kosongkan<br>
                        üí¨ <strong>Balasan:</strong> Bubble <span style="background: #dcf8c6; padding: 2px 6px; border-radius: 4px;">HIJAU</span> (dari kita)<br>
                        üí¨ <strong>Pesan:</strong> Bubble <span style="background: #fff; padding: 2px 6px; border-radius: 4px; border: 1px solid #ddd;">PUTIH</span> (dari kontak) - <strong>Otomatis "BATAL/CANCEL/RETUR"</strong> jika kosong
                    </p>
                    
                    <input type="file" id="bulkExcelFile" accept=".xlsx,.xls" onchange="handleBulkExcel()" class="file-input">
                    <label for="bulkExcelFile" class="file-label">
                        <span class="material-symbols-outlined">table_view</span>
                        Pilih File Excel
                    </label>
                    
                    <div id="bulkPreview" style="display: none;">
                        <div class="preview-badge">
                            ‚úÖ Data: <span id="bulkRowCount">0</span> baris
                        </div>
                        <div id="bulkDataPreview" class="data-preview"></div>
                    </div>
                    
                    <button id="btnBulkGenerate" onclick="startBulkGenerate()" disabled class="btn-success" style="display: none;">
                        <span class="material-symbols-outlined">rocket_launch</span>
                        Generate & Export ZIP
                    </button>
                    
                    <div id="bulkProgress" style="display: none;" class="progress-section">
                        <p class="progress-text">Progress: <span id="progressText">0/0</span></p>
                        <div class="progress-bar-container">
                            <div id="progressBar" class="progress-bar"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PANEL MOCKUP -->
        <div class="mockup-panel">
            <div class="collage-container">
                
                <!-- ========== PANEL 1: CHAT VIEW ========== -->
                <div id="chat-view" class="screen collage-item">
                    <div class="status-bar">
                        <div class="status-left">
                            <span class="status-time">21:42</span>
                            <span class="network-speed">‚Üì 128 kbps</span>
                        </div>
                        <div class="status-icons">
                            <span class="network-type">4G</span>
                            <span class="material-symbols-outlined">signal_cellular_alt</span>
                            <span class="battery-text">5%</span>
                            <span class="material-symbols-outlined">battery_0_bar</span>
                        </div>
                    </div>

                    <div class="header chat-header">
                        <span class="material-symbols-outlined arrow-back">arrow_back</span>
                        <div class="wa-avatar-header" id="avatar-chat" style="padding: 0; overflow: hidden;">
                            <img class="avatar-img" src="https://i.ibb.co.com/HT77KvxN/image.png" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%; display: block;">
                            <span class="material-symbols-outlined avatar-icon" style="display: none;">person</span>
                        </div>
                        <div class="header-info">
                            <span class="contact-name" id="displayContactNameTop">+628126637346</span>
                            <span class="contact-status" id="displayContactStatusTop">online</span>
                        </div>
                        <div class="icon-group">
                            <span class="material-symbols-outlined">videocam</span>
                            <span class="material-symbols-outlined">call</span>
                            <span class="material-symbols-outlined">more_vert</span>
                        </div>
                    </div>

                    <div class="chat-body">
                        <div class="date-divider">Hari ini</div>
                        <div class="system-message">
                            <span class="material-symbols-outlined">lock</span> Pesan dan panggilan terenkripsi secara end-to-end. Hanya orang di chat ini yang bisa membaca, mendengarkan, atau membagikannya. Pelajari selengkapnya.
                        </div>
                    </div>

                    <div class="footer">
                        <div class="input-pill">
                            <span class="material-symbols-outlined emoji-icon">sentiment_satisfied</span>
                            <input type="text" placeholder="Ketik pesan" disabled>
                            <span class="material-symbols-outlined attach-icon">attach_file</span>
                            <span class="material-symbols-outlined camera-icon">photo_camera</span>
                        </div>
                        <span class="material-symbols-outlined mic-fab">mic</span>
                    </div>
                    
                    <div class="nav-bar">
                        <div class="nav-item"><span>|||</span></div>
                        <div class="nav-item"><span class="material-symbols-outlined">circle</span></div>
                        <div class="nav-item"><span class="material-symbols-outlined">chevron_left</span></div>
                    </div>
                </div>

                <!-- ========== PANEL 2: PROFILE VIEW ========== -->
                <div id="profile-view" class="screen collage-item">
                    <div class="status-bar">
                        <div class="status-left">
                            <span class="status-time">21:42</span>
                            <span class="network-speed">‚Üì 128 kbps</span>
                        </div>
                        <div class="status-icons">
                            <span class="network-type">4G</span>
                            <span class="material-symbols-outlined">signal_cellular_alt</span>
                            <span class="battery-text">5%</span>
                            <span class="material-symbols-outlined">battery_0_bar</span>
                        </div>
                    </div>

                    <div class="profile-wrapper">
                        <div class="profile-top-nav">
                        
                        </div>

                        <div class="profile-avatar-section">
                            <div class="profile-avatar-large" id="avatar-profile" style="padding: 0; overflow: hidden;">
                                <img class="avatar-img" src="https://i.ibb.co.com/HT77KvxN/image.png" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%; display: block;">
                                <span class="material-symbols-outlined avatar-icon" style="display: none;">person</span>
                            </div>
                            <div class="profile-phone-number" id="displayContactPhoneCenter">+62 812-6637-6346</div>
                            <div class="profile-name-wrapper">
                                <div class="profile-contact-name-display" id="displayContactNameCenter">~ Amora Pricilia</div>
                            </div>
                            <div class="profile-bio-wrapper">
                                <div class="profile-bio" id="displayContactBioCenter"></div>
                            </div>
                        </div>

                        <div class="profile-actions">
                            <div class="action-btn">
                                <div class="action-icon">
                                    <span class="material-symbols-outlined">call</span>
                                    <span>Panggilan</span>
                                </div>
                            </div>
                            <div class="action-btn">
                                <div class="action-icon">
                                    <span class="material-symbols-outlined">videocam</span>
                                    <span>Video</span>
                                </div>
                            </div>
                            <div class="action-btn">
                                <div class="action-icon">
                                    <span class="material-symbols-outlined">group</span>
                                    <span>Simpan</span>
                                </div>
                            </div>
                            <div class="action-btn">
                                <div class="action-icon">
                                    <span class="material-symbols-outlined">search</span>
                                    <span>Cari</span>
                                </div>
                            </div>
                        </div>

                        <div class="list-section">
                            <div class="list-item no-bottom-border">
                                <span class="material-symbols-outlined">notifications</span>
                                <span class="list-title">Notifikasi</span>
                            </div>
                            <div class="list-item">
                                <span class="material-symbols-outlined">image</span>
                                <span class="list-title">Visibilitas media</span>
                            </div>
                        </div>

                        <div class="list-section">
                            <div class="list-item multi-line no-bottom-border">
                                <span class="material-symbols-outlined">lock</span>
                                <div class="list-content">
                                    <span class="list-title">Enkripsi</span>
                                    <span class="list-subtitle">Pesan dan panggilan terenkripsi secara end-to-end. Ketuk untuk memverifikasi.</span>
                                </div>
                            </div>
                            <div class="list-item multi-line no-bottom-border">
                                <span class="material-symbols-outlined">schedule</span>
                                <div class="list-content">
                                    <span class="list-title">Pesan sementara</span>
                                    <span class="list-subtitle">Mati</span>
                                </div>
                            </div>
                            <div class="list-item multi-line with-toggle no-bottom-border">
                                <span class="material-symbols-outlined">lock</span>
                                <div class="list-content">
                                    <span class="list-title">Kunci chat</span>
                                    <span class="list-subtitle">Kunci dan sembunyikan chat ini di perangkat ini.</span>
                                </div>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="toggle1">
                                    <label for="toggle1" class="slider"></label>
                                </div>
                            </div>
                            <div class="list-item multi-line no-bottom-border">
                                <span class="material-symbols-outlined">security</span>
                                <div class="list-content">
                                    <span class="list-title">Privasi chat tingkat lanjut</span>
                                    <span class="list-subtitle">Mati</span>
                                </div>
                            </div>
                        </div>

                        <div class="list-section action-list">
                            <div class="no-group-header">Tidak ada grup yang sama</div>
                            <div class="list-item green-action">
                                <span class="material-symbols-outlined">group</span>
                                <span class="list-title">Buat grup dengan <span class="contact-action-name">+62 812-6637-6346</span></span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="nav-bar">
                        <div class="nav-item"><span>|||</span></div>
                        <div class="nav-item"><span class="material-symbols-outlined">circle</span></div>
                        <div class="nav-item"><span class="material-symbols-outlined">chevron_left</span></div>
                    </div>
                </div>

                <!-- ========== PANEL 3: PROFILE SCROLLED - FIXED ========== -->
                <div id="profile-view-scrolled" class="screen collage-item">
                    <div class="status-bar">
                        <div class="status-left">
                            <span class="status-time">21:42</span>
                            <span class="network-speed">‚Üì 128 kbps</span>
                        </div>
                        <div class="status-icons">
                            <span class="network-type">4G</span>
                            <span class="material-symbols-outlined">signal_cellular_alt</span>
                            <span class="battery-text">5%</span>
                            <span class="material-symbols-outlined">battery_0_bar</span>
                        </div>
                    </div>

                    <div class="profile-header-sticky">
                        <span class="material-symbols-outlined arrow-back">arrow_back</span>
                        <div class="profile-header-info">
                            <div class="wa-avatar-small" id="avatar-scrolled" style="padding: 0; overflow: hidden;">
                                <img class="avatar-img" src="https://i.ibb.co.com/HT77KvxN/image.png" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%; display: block;">
                                <span class="material-symbols-outlined avatar-icon" style="display: none;">person</span>
                            </div>
                            <span class="scrolled-contact-name" id="displayContactNameScrolled">+62 812-6637-6346</span>
                        </div>
                        <span class="material-symbols-outlined more-vert">more_vert</span>
                    </div>

                    <div class="profile-wrapper scrolled">
                        <!-- SECTION 1: NOTIFIKASI & VISIBILITAS MEDIA -->
                        <div class="list-section">
                            <div class="list-item no-bottom-border">
                                <span class="material-symbols-outlined">notifications</span>
                                <span class="list-title">Notifikasi</span>
                            </div>
                            <div class="list-item">
                                <span class="material-symbols-outlined">image</span>
                                <span class="list-title">Visibilitas media</span>
                            </div>
                        </div>

                        <!-- SECTION 2: ENKRIPSI, PESAN SEMENTARA, KUNCI CHAT, PRIVASI -->
                        <div class="list-section">
                            <div class="list-item multi-line no-bottom-border">
                                <span class="material-symbols-outlined">lock</span>
                                <div class="list-content">
                                    <span class="list-title">Enkripsi</span>
                                    <span class="list-subtitle">Pesan dan panggilan terenkripsi secara end-to-end. Ketuk untuk memverifikasi.</span>
                                </div>
                            </div>
                            <div class="list-item multi-line no-bottom-border">
                                <span class="material-symbols-outlined">schedule</span>
                                <div class="list-content">
                                    <span class="list-title">Pesan sementara</span>
                                    <span class="list-subtitle">Mati</span>
                                </div>
                            </div>
                            <div class="list-item multi-line with-toggle no-bottom-border">
                                <span class="material-symbols-outlined">lock</span>
                                <div class="list-content">
                                    <span class="list-title">Kunci chat</span>
                                    <span class="list-subtitle">Kunci dan sembunyikan chat ini di perangkat ini.</span>
                                </div>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="toggle2">
                                    <label for="toggle2" class="slider"></label>
                                </div>
                            </div>
                            <div class="list-item multi-line no-bottom-border">
                                <span class="material-symbols-outlined">security</span>
                                <div class="list-content">
                                    <span class="list-title">Privasi chat tingkat lanjut</span>
                                    <span class="list-subtitle">Mati</span>
                                </div>
                            </div>
                        </div>

                        <!-- SECTION 3: BUAT GRUP -->
                        <div class="list-section action-list">
                            <div class="no-group-header">Tidak ada grup yang sama</div>
                            <div class="list-item green-action">
                                <span class="material-symbols-outlined">group</span>
                                <span class="list-title">Buat grup dengan <span class="contact-action-name">+62 812-6637-6346</span></span>
                            </div>
                        </div>

                        <!-- SECTION 4: TAMBAH KE DAFTAR, BLOKIR, LAPORKAN -->
                        <div class="list-section action-list">
                            <div class="list-item no-bottom-border">
                                <span class="material-symbols-outlined">Switch_Account</span>
                                <span class="list-title">Tambah ke daftar</span>
                            </div>
                            <div class="list-item red-action no-bottom-border">
                                <span class="material-symbols-outlined">block</span>
                                <span class="list-title">Blokir <span class="contact-action-name">+62 812-6637-6346</span></span>
                            </div>
                            <div class="list-item red-action no-bottom-border">
                                <span class="material-symbols-outlined">Thumb_Down</span>
                                <span class="list-title">Laporkan <span class="contact-action-name">+62 812-6637-6346</span></span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="nav-bar">
                        <div class="nav-item"><span>|||</span></div>
                        <div class="nav-item"><span class="material-symbols-outlined">circle</span></div>
                        <div class="nav-item"><span class="material-symbols-outlined">chevron_left</span></div>
                    </div>
                </div>

            </div>
        </div>
    </div>
